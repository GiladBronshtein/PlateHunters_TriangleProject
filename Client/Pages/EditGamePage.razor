@page "/EditGame/{gameCode}";
@inject HttpClient Http
@inject NavigationManager Nav
@inject IStringLocalizer<SharedResources> Localizer
@using TriangleProject.Shared.Models.Games;
@using TriangleProject.Shared.Models.GamesContent;
@using TriangleProject.Shared.Models.Users;


@if (gameData != null)
{
    <div class="editform">
        <EditForm Model="gameData" OnValidSubmit="formSubmit" OnInvalidSubmit="failedSubmit">
            <DataAnnotationsValidator />
            <table class="MainTable">
                <tr id="GameSettingTitle">
                    <th colspan="5">
                        @Localizer["GameSettings"] -
                        <label>@Localizer["GameEdit"] - GameID: @gameData.GameCode @msg</label>
                    </th>
                </tr>
                <tr id="GameNameSettings">
                    <td style="width:12%;">
                        <i class="fa fa-check-circle icon"></i>
                        <label>@Localizer["GameName"]</label>
                    </td>
                    <td style="width:15%;">
                        <CustomInputText CustomValueChanged="HandleInputChange" @bind-Value="gameData.GameName"
                          alert="" class="default-input" maxlength="30" maxChars="30" minChars="2" inputWidth="320px" />
                    </td>
                    <td rowspan="3" style="text-align:center;" class="gameQuestionTD">
                        <div class="flexContainer">
                            <div class="flexItem">
                                הנחייה עם טקסט בלבד
                            </div>
                            <div class="flexItem">
                                <div class="checkbox-wrapper-64">
                                    <label class="switch">
                                        <input type="checkbox">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="flexItem">
                                הנחייה עם טקסט ותמונה
                            </div>
                            <div class="flexItem">
                                <!-----------------------------------
                                    ADDING IMAGE TO GAME QUESTION 
                                ------------------------------------->

                                <label class="uploadImg" for="QuestionFileInputID">
                                    <i class="fa fa-picture-o" aria-hidden="true" style="color:black;font-size:44px;"></i>
                                </label>
                                <InputFile name="QuestionImage" id="QuestionFileInputID" OnChange="@(e => UploadFile(e, "QuestionImage"))" hidden />
                            </div>



                        </div>
                    </td>
                    <td rowspan="2" style="text-align:center; " class="GezaTextandPicture">
                        <div class="checkbox-wrapper-64">
                            <span class="switchText">הפעלת תצוגה מקדימה</span>
                            <label class="switch">
                                <input type="checkbox" @bind="isPreviewOn">
                                <span class="slider"></span>
                            </label>
                        </div>
                        @if (isPreviewOn)
                        {
                            <div class="preview">
                                @if (!string.IsNullOrEmpty(gameData.QuestionDescription))
                                {
                                    <p>@gameData.QuestionDescription</p>
                                }
                                @if (gameData.QuestionHasImage)
                                {
                                    @if (!string.IsNullOrEmpty(gameData.QuestionImageText))
                                    {
                                        <img src="@gameData.QuestionImageText" width="50" style="padding-top:7px; float: left;"/>
                                    }
                                }

                            </div>
                        }

                    </td>
                </tr>
                <tr id="GameQuestionSettings">
                    <td>
                        <i class="fa fa-check-circle icon"></i>
                        <label>@Localizer["GameQuestion"]</label>
                    </td>
                    <td>
                        <CustomInputText CustomValueChanged="HandleInputChange" @bind-Value="gameData.QuestionDescription" alert="" class="default-input" maxlength="70" maxChars="70" minChars="2" inputWidth="320px" />
                    </td>
                </tr>
            </table>
            <table class="Categories">
                <tr>
                    <td style="width:10%;">
                        <label>@Localizer["GameCorrectCategory"]</label>
                    </td>
                    <td>
                        <CustomInputText CustomValueChanged="HandleInputChange" @bind-Value="gameData.QuestionCorrectCategory" alert="כתבו את הקטגוריה הנכונה" class="default-input" maxlength="25" maxChars="25" minChars="2" inputWidth="280px" />
                    </td>
                    <td style="width:12%;">
                        <label>@Localizer["GameWrongCategory"]</label>
                    </td>
                    <td>
                        <CustomInputText CustomValueChanged="HandleInputChange" @bind-Value="gameData.QuestionWrongCategory" alert="כתבו את הקטגוריה הלא נכונה" class="default-input" maxlength="25" maxChars="25" minChars="2" inputWidth="280px" />
                    </td>
                    <td style="text-align:center;width:10%;">
                        @if (hasChanges)
                        {
                            <input type="button" class="btn btn-primary saveBTN" @onclick="ShowSaveSettingsModal" value="@Localizer["SaveSettings"]" />
                        }
                        else
                        {
                            <input type="button" class="btn btn-primary saveBTN" @onclick="ShowNothingChangedModal" value="@Localizer["SaveSettings"]" />
                        }
                    </td>
                </tr>
            </table>
            <div class="Answers">
                <div class="row">
                    <div class="col-6 col-md-4 division1">
                        <table style="background-color:#F7F7F7; border: 0px solid black;">
                            <tr style="background-color:#F7F7F7;">
                                <td style="text-align:center; height:15px;" colspan="5"> <b> הוספת תשובה </b></td>
                            </tr>
                            <tr style="border-bottom: 3px solid white; background-color:#F7F7F7;  height:80px;">
                                <td style="text-align:center;">
                                    <div class="textBTN">
                                        טקסט
                                        <button type="button" value="טקסט" class="picortext " @onclick="ChangeToPic">
                                            <i class="fa fa-file-text-o textButton"></i>
                                        </button>
                                    </div>
                                </td>

                                <td style="text-align:center;width:10%;">
                                    <h3>או</h3>
                                </td>

                                <td style="text-align:center;" id="picBTN">
                                    <div class="picBTN">
                                        <button type="button" value="תמונה" class="picortext " @onclick="ChangeToText">
                                            <i class="fa fa-picture-o picButton"></i>
                                        </button>
                                        תמונה

                                    </div>
                                </td>
                            </tr>
                            @if (textOrPic)
                            {
                                <tr style="background-color:#F7F7F7; height:40px; text-align:center;">
                                    <td>
                                        <div class="rightText">
                                            נכון
                                        </div>
                                    </td>
                                    <td>
                                        <div class="checkbox-wrapper-64">
                                            <label class="switch">
                                                <input type="checkbox" @bind="newIsCorrect" />
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="wrongText">

                                            לא נכון
                                        </div>
                                    </td>
                                </tr>
                                <tr style="height:200px;">
                                    <td colspan="3">
                                        <div class="plasteanswer">
                                            <div class="container">
                                                <img src="assets-images/plate_Hunters_Plate.png">
                                                <div class="centered">
                                                    <textarea id="story" placeholder="כתבו תשובה" rows="2" cols="7" @bind="inputData"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr colspan="3">
                                    @if (!editAnswer)
                                    {
                                        <td colspan="3">
                                            <div id="answerBTN">
                                                <button type="button" class="btn btn-primary" value="שמירת תשובה" @onclick="AddTextAnswerToTable">שמירת תשובה</button>
                                            </div>
                                        </td>

                                    }
                                    else
                                    {
                                        <td colspan="3">
                                            <div id="answerEditCancel">
                                                <button type="button" class="btn btn-secondary" value="ביטול" @onclick="cancelEdit">ביטול</button>
                                            </div>
                                            <div id="answerBTN">
                                                <button type="button" class="btn btn-success" value="שמירת תשובה" @onclick="submitEdit">עריכת תשובה</button>
                                            </div>
                                        </td>
                                    }
                                </tr>
                            }
                            else
                            {
                                <tr style="background-color:#F7F7F7; height:40px; text-align:center;">
                                    <td>
                                        נכון
                                    </td>
                                    <td>
                                        <div class="checkbox-wrapper-64">
                                            <label class="switch">
                                                <input type="checkbox" @bind="newIsCorrect" />
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </td>
                                    <td>
                                        לא נכון
                                    </td>
                                </tr>
                                <tr style="height:200px;">
                                    <td colspan="3">
                                        <div class="plasteanswer">
                                            <div class="container">
                                                <img src="assets-images/plate_Hunters_Plate.png">
                                                <div class="centered">
                                                    <div class="tablerow">
                                                        @if (myFileImage != "")
                                                        {

                                                            <div class="img-wrapper">
                                                                <img src="@myFileImage" />
                                                            </div>
                                                            <div class="trashImage">
                                                                @if (myFileImage != "")
                                                                {
                                                                    <i class="fa fa-trash-o icon" style="font-size:20px;" @onclick="MakeDeleteList"></i>
                                                                }
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <label class="uploadImg" for="FileInputID">
                                                                <i class="fa fa-upload" aria-hidden="true" style="color:black;font-size:44px;"></i>
                                                            </label>
                                                            <InputFile name="AnswerImage" id="FileInputID" OnChange="@(e => UploadFile(e, "AnswerImage"))" hidden />
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr colspan="3">
                                    @if (!editAnswer)
                                    {
                                        <td colspan="3">
                                            <div id="answerBTN">
                                                <button type="button" class="btn btn-primary" value="שמירת תשובה" @onclick="AddPicAnswerToTable">שמירת תשובה</button>
                                            </div>
                                        </td>
                                    }
                                    else
                                    {
                                        <td colspan="3">
                                            <div id="answerEditCancel">
                                                <button type="button" class="btn btn-secondary" value="ביטול" @onclick="cancelEdit">ביטול</button>
                                            </div>
                                            <div id="answerBTN">
                                                <button type="button" class="btn btn-success" value="שמירת תשובה" @onclick="submitEdit">עריכת תשובה</button>
                                            </div>
                                        </td>
                                    }
                                </tr>
                            }
                        </table>
                    </div>
                    <div class="col-6 col-md-4 table1">
                        <table class="col-6 col-md-4 table table-hover">
                            <tr>
                                <th colspan="3" style="text-align:center; background-color:#EEF3E7;">
                                    @gameData.QuestionCorrectCategory
                                    (@countCorrectAnswers)
                                </th>
                            </tr>
                            <tbody class="correct-table">
                                @foreach (var item in tempAnswersData)
                                {
                                    @if (@item.IsCorrect)
                                    {
                                        <tr>
                                            <td style="width:80%;">
                                                @if (@item.HasImage)
                                                {
                                                    <div class="img-present">
                                                        <input type="checkbox" id="enlargeImageToggle_@item.ID" class="enlarge-toggle">
                                                        <label for="enlargeImageToggle_@item.ID" class="img-container" tabindex="0">
                                                            <img src="@item.AnswerImageText" class="image" />
                                                            <div class="overlay">
                                                                <i class="fa fa-search-plus"></i>
                                                            </div>
                                                        </label>
                                                        <label for="enlargeImageToggle_@item.ID" class="close-button">X</label>
                                                    </div>
                                                }
                                                else
                                                {
                                                    @item.AnswerDescription
                                                }
                                            </td>
                                            <td style="width:10%;">
                                                <i class="fa fa-pencil icon" style="font-size:20px;" @onclick="@(()=>EditAnswer(item.ID))"></i>
                                            </td>
                                            <td style="width:10%;">
                                                <i class="fa fa-trash-o icon" style="font-size:20px;" @onclick="@(()=>ShowDeleteModal(item.ID))"></i>
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="col-6 col-md-4  table2">
                        <table class="col-6 col-md-4 table table-hover">
                            <tr>
                                <th colspan="3" style="text-align:center; background-color:#EEDFDF;">
                                    @gameData.QuestionWrongCategory
                                    (@countWrongAnswers)

                                </th>
                            </tr>
                            <tbody class="wrong-table">
                                @foreach (var item in tempAnswersData)
                                {
                                    @if (!@item.IsCorrect)
                                    {
                                        <tr>
                                            <td style="width:80%;">
                                                @if (@item.HasImage)
                                                {
                                                    <div class="img-present">
                                                        <input type="checkbox" id="enlargeImageToggle_@item.ID" class="enlarge-toggle">
                                                        <label for="enlargeImageToggle_@item.ID" class="img-container" tabindex="0">
                                                            <img src="@item.AnswerImageText" class="image" />
                                                            <div class="overlay">
                                                                <i class="fa fa-search-plus"></i>
                                                            </div>
                                                        </label>
                                                        <label for="enlargeImageToggle_@item.ID" class="close-button">X</label>
                                                    </div>
                                                }
                                                else
                                                {
                                                    @item.AnswerDescription
                                                }
                                            </td>
                                            <td style="width:10%;">
                                                <i class="fa fa-pencil icon" style="font-size:20px;" @onclick="@(()=>EditAnswer(item.ID))"></i>
                                            </td>
                                            <td style="width:10%;">
                                                <i class="fa fa-trash-o icon" style="font-size:20px;" @onclick="@(() => ShowDeleteModal(item.ID))"></i>
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="footer">
                <table style="width:100%;">
                    <tr>
                        <td style="width:12%;">
                            <label>@Localizer["GameEndMessage"]</label>
                        </td>
                        <td style="width:50%;">
                            <CustomInputText CustomValueChanged="HandleInputChange" @bind-Value="gameData.GameEndMessage" alert="" class="default-input" maxlength="50" maxChars="50" minChars="2" inputWidth="380px" />

                        </td>
                        <td style="text-align:center;width:250px;">
                            @if (gameData.IsPublished == false)
                            {
                                <input type="button" class="btn btn-success" @onclick="ShowPublishModal" value="@Localizer["GamePublish"]" />
                            }
                            else
                            {
                                <input type="button" class="btn btn-outline-success" @onclick="ShowPublishModal" value="@Localizer["Unpublish"]" />
                            }
                        </td>
                        <td style="text-align:center;width:250px;">
                            @if (hasChanges)
                            {
                                <button class="btn btn-secondary backBTN" @onclick="ShowSaveModal">@Localizer["Back"]</button>
                            }
                            else
                            {
                                <button class="btn btn-secondary backBTN" @onclick="CancelEdit">@Localizer["Back"]</button>
                            }
                        </td>
                    </tr>
                </table>
            </div>
        </EditForm>
    </div>
    <p>@pageMsg</p>
}

@code {
    [CascadingParameter]
    public IModalService Modal { get; set; } // Inject IModalService

    [CascadingParameter]
    public int UserId { get; set; } // Inject UserId

    [Parameter]
    public string gameCode { get; set; } // Inject gameCode

    // [Parameter]
    // public List<Games> GamesList { get; set; } // Inject GamesList

    GameDetails gameData; // Object to hold the game data
    UserWithGames user; // Object to hold the user data

    List<GameAnswers> answersDataToDelete = new List<GameAnswers>(); // List to hold the answers to delete
    List<GameAnswers> tempAnswersData = new List<GameAnswers>(); // List to hold the answers data
    List<string> DeleteImages = new List<string>(); // List to hold the images to delete

    string inputClass = ""; // variable to hold the input class
    string alert = ""; // variable to hold the alert message
    string myFileImage = ""; // New variable to hold the image file name
    string myQuestionFileImage = ""; // New variable to hold the image file name
    string msg = ""; // variable to hold the message to display to the user
    string pageMsg = ""; // variable to hold the message to display to the user
    string inputData = ""; // variable to hold the input data from the user

    long maxFileSize = 4194304; //4MB
    int edititem = 0; // variable to hold the edit item id
    int gameNameLength = 0; // variable to hold the length of gameData.GameName
    int gameAnswersCount = 0; // variable to hold the number of answers in the game
    int countCorrectAnswers = 0;
    int countWrongAnswers = 0;

    bool publishConfirm = false; // variable to hold the publish confirmation state
    bool editAnswer = false; // variable to hold the edit answer state
    bool isPreviewOn = false; // variable to hold the preview state
    bool newIsPublished = false; // variable to hold the is published state
    bool newCanPublish = false; // variable to hold the can publish state
    bool newIsCorrect = true; // variable to hold the is correct state
    bool textOrPic = true; // variable to hold the text or pic state
    bool uploadButton = true; // variable to hold the upload button state
    bool hasChanges = false; // variable to hold the has changes state


    //////////////////////////////////////////////////////////
    ////////////////////     Methods    //////////////////////
    //////////////////////////////////////////////////////////

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var response = await Http.GetAsync($"api/game/" + UserId + "/getGame/" + gameCode);

            if (response.Headers.Contains("X-Error") && response.Headers.GetValues("X-Error").FirstOrDefault() == "BadRequest")
            {
                Nav.NavigateTo("/badrequest");
                return; // Exit the method early since we're navigating away
            }

            gameData = await response.Content.ReadFromJsonAsync<GameDetails>();
            gameNameLength = gameData.GameName.Count();
            gameAnswersCount = gameData.Answers.Count();

            //get all answers from database to tempTableData
            foreach (var answer in gameData.Answers)
            {
                var gameAnswer = new GameAnswers
                    {
                        ID = answer.ID,
                        AnswerDescription = answer.AnswerDescription,
                        IsCorrect = answer.IsCorrect,
                        HasImage = answer.HasImage,
                        AnswerImageText = answer.AnswerImageText
                    };
                // Add the new GameAnswers object to the tempTableData list
                tempAnswersData.Add(gameAnswer);
            }

            countCorrectAnswers = tempAnswersData.Where(x => x.IsCorrect == true).Count();
            countWrongAnswers = tempAnswersData.Where(x => x.IsCorrect == false).Count();
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
            pageMsg = "Error getting game data";
        }
    }

    //edit game data save to database
    async Task EditGameData()
    {
        hasChanges = true;
        //return new gameData with the form details
        GameDetails newGame = new GameDetails()
            {
                ID = gameData.ID,
                GameCode = gameData.GameCode,
                GameName = gameData.GameName,
                QuestionDescription = gameData.QuestionDescription,
                GameEndMessage = gameData.GameEndMessage,
                CanPublish = gameData.CanPublish,
                IsPublished = gameData.IsPublished,
                QuestionCorrectCategory = gameData.QuestionCorrectCategory,
                QuestionWrongCategory = gameData.QuestionWrongCategory,
                Answers = tempAnswersData,
                AnswersToDelete = answersDataToDelete,
                QuestionImageText = gameData.QuestionImageText,
                QuestionHasImage = gameData.QuestionHasImage
            };
        foreach (var item in tempAnswersData)
        {
            Console.WriteLine("LOG NEW: " + item.ID);
        }
        await Http.PutAsJsonAsync($"api/game/" + UserId + "/updateGame/" + gameCode, newGame);
    }

    //cancel edit and return to page with auth
    private void CancelEdit()
    {
        Nav.NavigateTo("/Pagewithauth");
    }

    //check if the game can be published
    async Task checkCanPublish()
    {
        newCanPublish = gameData.CanPublish;
        newCanPublish = await Http.GetFromJsonAsync<bool>($"api/game/" + UserId + "/canPublish/" + gameData.ID);
        if (newCanPublish == true)
        {
            newIsPublished = true;
        }
        else
        {
            newIsPublished = false;
        }
    }

    //form submit method
    private void formSubmit()
    {
        EditGameData();
        checkCanPublish();
    }

    //failed submit method
    private void failedSubmit()
    {
        msg = "failed to sumbit!";
    }

    //edit publish status method to change IsPublished value on the server db
    async Task changePublish(GameDetails game)
    {
        //return new gameData with the form details
        PublishGame gameToSend = new PublishGame();
        gameToSend.ID = gameData.ID;
        gameToSend.IsPublished = !gameData.IsPublished;

        var userRes = await Http.PostAsJsonAsync("api/game/" + UserId + "/publishGame", gameToSend);
        if (userRes.IsSuccessStatusCode == true)
        {
            gameData.IsPublished = gameToSend.IsPublished;

            if (gameData.IsPublished == true)
            {
                msg = "Game published";
            }
            else
            {
                msg = "Game unpublished";
            }
        }
        else
        {
            string error = userRes.Content.ReadAsStringAsync().Result;
            switch (error)
            {
                case "No Session":
                    msg = "Session error, please reload page";
                    break;
                case "User Not Logged In":
                    msg = "You are not logged in, please reload page to try again";
                    break;
                case "User Not Found":
                    msg = "the user details not found, please reload page to try again";
                    break;
                case "Game not created":
                    msg = "There was a problem creating the game";
                    break;
                case "Game code not created":
                    msg = "There was a problem generating the game code";
                    break;
                case "It's Not Your Game":
                    msg = "You tried to update a game that is not associated with your user";
                    break;
                case "This game cannot be published":
                    msg = @Localizer["The game does not meet the conditions of publishing"];
                    break;
            }
        }
    }

    //show modal method to show modal with confirmation message
    async Task ShowPublishModal()
    {
        var parameters = new ModalParameters()
            .Add(nameof(PopUpComponent.Message), "האם ברצונכם לשנות את סטאטוס הפרסום?"); // Pass parameter(s) to modal component
        var messageForm = Modal.Show<PopUpComponent>("פרסום משחק", parameters); // Show modal
        var result = await messageForm.Result; // Get result from modal
        if (result.Confirmed)
        {
            await changePublish(gameData);
        }
        else
        {
            Console.WriteLine("Not confirmed");
        }
        var currentUrl = Nav.Uri;
        // Navigate to the current URL to reload the page
        Nav.NavigateTo(currentUrl);
    }

    async Task ShowDeleteModal(int itemToDelete)
    {
        var parameters = new ModalParameters()
            .Add(nameof(PopUpComponent.Message), "האם ברצונכם למחוק את המסיח?"); // Pass parameter(s) to modal component
        var messageForm = Modal.Show<PopUpComponent>("מחיקת מסיח", parameters); // Show modal
        var result = await messageForm.Result; // Get result from modal
        if (result.Confirmed)
        {
            RemoveFromTable(itemToDelete);
        }
        else
        {
            Console.WriteLine("Not confirmed");
        }
        var currentUrl = Nav.Uri;
        // Navigate to the current URL to reload the page
        Nav.NavigateTo(currentUrl);
    }

    async Task ShowSaveModal()
    {

        var parameters = new ModalParameters()
          .Add(nameof(PopUpComponent.Message), "האם ברצונכם לשמור את המשחק?"); // Pass parameter(s) to modal component
        var messageForm = Modal.Show<PopUpComponent>("שמירת משחק", parameters); // Show modal
        var result = await messageForm.Result; // Get result from modal
        if (result.Confirmed)
        {
            // EditGameData();
            // checkCanPublish();
            Nav.NavigateTo("Pagewithauth");

        }
        else
        {
            Console.WriteLine("Not confirmed");
        }
        var currentUrl = Nav.Uri;
        // Navigate to the current URL to reload the page
        Nav.NavigateTo("Pagewithauth");
    }

    async Task ShowSaveSettingsModal()
    {
        var parameters = new ModalParameters()
          .Add(nameof(PopUpComponent.Message), "האם ברצונכם לשמור את הגדרות המשחק?"); // Pass parameter(s) to modal component
        var messageForm = Modal.Show<PopUpComponent>("שמירת משחק", parameters); // Show modal
        var result = await messageForm.Result; // Get result from modal
        if (result.Confirmed)
        {
            Console.WriteLine("Confirmed");
            EditGameData();
            checkCanPublish();
            Nav.NavigateTo("Pagewithauth");

        }
        else
        {
            Console.WriteLine("Not confirmed");
        }
        var currentUrl = Nav.Uri;
        // Navigate to the current URL to reload the page
        Nav.NavigateTo(currentUrl);
    }

    async Task ShowNothingChangedModal()
    {

        var parameters = new ModalParameters();
        parameters.Add("Message", "לא שיניתם כלום? המשיכו לערוך");
        Modal.Show<About>("מה נשתנה?", parameters);
    }

    //method to add new item into the answers list - later add to database
    private void AddTextAnswerToTable()
    {
        if (!string.IsNullOrWhiteSpace(inputData))
        {
            var gameAnswer = new GameAnswers
                {
                    // GameID = gameData.ID,
                    AnswerDescription = inputData,
                    IsCorrect = newIsCorrect,
                    HasImage = false,
                    AnswerImageText = "empty"
                };

            // Add the new GameAnswers object to the tempTableData list
            tempAnswersData.Add(gameAnswer);
            inputData = "";
            hasChanges = true;

            countCorrectAnswers = tempAnswersData.Where(x => x.IsCorrect == true).Count();
            countWrongAnswers = tempAnswersData.Where(x => x.IsCorrect == false).Count();

        }
    }

    //method to add new item into the answers list - later add to database
    private void AddPicAnswerToTable()
    {
        if (!string.IsNullOrWhiteSpace(myFileImage))
        {
            var gameAnswer = new GameAnswers
                {
                    // GameID = gameData.ID,
                    AnswerDescription = "-",
                    IsCorrect = newIsCorrect,
                    HasImage = true,
                    AnswerImageText = myFileImage
                };

            // Add the new GameAnswers object to the tempTableData list
            tempAnswersData.Add(gameAnswer);
            myFileImage = "";
            hasChanges = true;

            countCorrectAnswers = tempAnswersData.Where(x => x.IsCorrect == true).Count();
            countWrongAnswers = tempAnswersData.Where(x => x.IsCorrect == false).Count();

        }
    }

    //Edit answer at the index of clicked row
    private void EditAnswer(int i)
    {
        editAnswer = true;
        //present the row information in the input fields
        foreach (var item in tempAnswersData)
        {
            if (item.ID == i)
            {
                edititem = i;
                if (item.HasImage)
                {
                    myFileImage = item.AnswerImageText;
                    newIsCorrect = item.IsCorrect;
                    textOrPic = false;
                }
                else
                {
                    inputData = item.AnswerDescription;
                    newIsCorrect = item.IsCorrect;
                    textOrPic = true;
                }
            }
        }
    }

    //submit edit answer (change the temptabledata)
    private void submitEdit()
    {
        foreach (var item in tempAnswersData)
        {
            if (item.ID == edititem)
            {
                if (textOrPic)
                {
                    item.AnswerDescription = inputData;
                    item.IsCorrect = newIsCorrect;
                    item.HasImage = false;
                    item.AnswerImageText = "empty";
                }
                else
                {
                    item.AnswerDescription = "-";
                    item.IsCorrect = newIsCorrect;
                    item.HasImage = true;
                    item.AnswerImageText = myFileImage;
                }
            }
        }
        editAnswer = false;
        hasChanges = true;

    }

    //cancel edit answer (change the temptabledata)
    private void cancelEdit()
    {
        editAnswer = false;
        myFileImage = "";
        inputData = "";
        textOrPic = true;
    }

    //Remove at the index of clicked row
    private void RemoveFromTable(int i)
    {
        Console.WriteLine(i);
        foreach (var item in tempAnswersData)
        {
            if (item.ID == i)
            {
                answersDataToDelete.Add(item);
                tempAnswersData.Remove(item);
                break;
            }
        }
        hasChanges = true;

        countCorrectAnswers = tempAnswersData.Where(x => x.IsCorrect == true).Count();
        countWrongAnswers = tempAnswersData.Where(x => x.IsCorrect == false).Count();

    }

    //method to change the bool type from text to image
    private void ChangeToPic()
    {
        //if textorpic clicked textorpic equals true
        textOrPic = true;
    }

    //method to change the bool type from image to text
    private void ChangeToText()
    {
        //if textorpic clicked textorpic equals true
        textOrPic = false;
    }

    //method to upload image to server
    private async Task UploadFile(InputFileChangeEventArgs e,string source)
    {
        Console.WriteLine("User Clicked: " + source);

        var imageFiles = e.GetMultipleFiles();
        foreach (var file in imageFiles)
        {
            if (file.Size <= maxFileSize)
            {
                var buffer = new byte[file.Size];
                await file.OpenReadStream(maxFileSize).ReadAsync(buffer);
                var imageBase64 = Convert.ToBase64String(buffer);
                var saveResponse = await Http.PostAsJsonAsync("api/media/upload", imageBase64);

                if (saveResponse.IsSuccessStatusCode == true)
                {
                    string resizeUrl = saveResponse.Content.ReadAsStringAsync().Result;

                    if(source =="AnswerImage")
                    {
                        myFileImage = "uploadedFiles/" + resizeUrl;
                    }
                    else
                    {
                        myQuestionFileImage = "uploadedFiles/" + resizeUrl;
                        hasChanges = true;
                        gameData.QuestionImageText = myQuestionFileImage;
                        gameData.QuestionHasImage = true;
                    }
                    
                }
            }

        }
    }

    //method to delete image from server
    private void MakeDeleteList()
    {
        DeleteImages.Add(myFileImage);
        myFileImage = "";
    }

    //method to hide upload button
    private void HideUploadButton()
    {

    }

    //method to delete image from server
    private async Task DeleteImage()
    {
        var saveResponse = await Http.PostAsJsonAsync("api/Media/deleteImages", DeleteImages);
        if (saveResponse.IsSuccessStatusCode == true)
        {
            msg = "deleted Successfully";
            DeleteImages.Clear();
        }
        else
        {
            msg = "DELETE ERROR";
        }
    }

    //method to count the chars in the input field
    void countChars(string field)
    {
        // Get the length of the input field
        int length = field.Length;

        if (length > 3 && length <= 10)
        {
            inputClass = "good-input";
            alert = $"יש בין 3 ל10 תווים";
        }
        else if (length > 10 && length <= 15)
        {
            inputClass = "warnning-input";
            alert = "יש בין 10 ל15 תווים";
        }
        else if (length > 10 && length <= 15)
        {
            inputClass = "warnning-input";
            alert = "יש בין 10 ל15 תווים";
        }
        else if (length > 15 && length < 30)
        {
            inputClass = "danger-input";
            alert = "יש יותר מ15 תווים";
        }
        else if (length >= 30)
        {
            inputClass = "danger-input";
            alert = "הגעת למקסימום התווים";
        }
        else
        {
            inputClass = "";
            alert = "אין מספיק תווים";
        }


    }

    private void HandleInputChange(string newValue)
    {
        hasChanges = true;
        Console.WriteLine(hasChanges);
    }
}